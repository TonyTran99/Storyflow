<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>StoryFlow 9 â€“ Kallaway Storytelling Coach (HTML, Context-Aware)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <meta name="description" content="StoryFlow 9 â€“ Trá»£ lÃ½ ká»ƒ chuyá»‡n theo 9 chiáº¿n thuáº­t Kallaway, Ä‘á»“ng bá»™ theo chá»§ Ä‘á» & Ä‘á»‘i tÆ°á»£ng" />
  <style>
    .prose ul { list-style: disc; padding-left: 1.25rem; }
    .fade-in { animation: fade .25s ease-in; }
    @keyframes fade { from {opacity:.0; transform: translateY(3px)} to {opacity:1; transform: translateY(0)} }
    .kbd { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-b from-slate-50 to-slate-100 text-slate-800">
  <!-- Header -->
  <header class="sticky top-0 z-10 bg-white/80 backdrop-blur border-b border-slate-200">
    <div class="mx-auto max-w-6xl px-4 py-4 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="h-9 w-9 rounded-xl bg-slate-900 text-white grid place-items-center font-bold">SF</div>
        <div>
          <h1 class="text-lg md:text-xl font-semibold">StoryFlow 9</h1>
          <p class="text-xs text-slate-500 -mt-0.5">Trá»£ lÃ½ ká»ƒ chuyá»‡n â€“ 9 chiáº¿n thuáº­t vÃ ng (Kallaway) â€¢ Context-Aware</p>
        </div>
      </div>
      <div class="flex items-center gap-2">
        <button id="copyJsonBtn" class="px-3 py-1.5 rounded-lg bg-slate-900 text-white text-sm hover:opacity-90">Sao chÃ©p JSON</button>
        <button id="resetBtn" class="px-3 py-1.5 rounded-lg border text-sm">Reset</button>
      </div>
    </div>
  </header>

  <main class="mx-auto max-w-6xl px-4 py-8 space-y-8">
    <!-- Controls -->
    <section class="bg-white/80 backdrop-blur rounded-2xl shadow-sm border border-slate-200 p-5 md:p-6">
      <div class="flex items-start gap-3 mb-3">
        <div class="h-9 w-9 shrink-0 rounded-xl bg-slate-900 text-white flex items-center justify-center text-sm font-semibold">âš™ï¸</div>
        <h2 class="text-xl md:text-2xl font-semibold text-slate-800 leading-tight">Thiáº¿t láº­p nhanh</h2>
      </div>

      <div class="grid md:grid-cols-2 gap-5">
        <!-- Chá»§ Ä‘á» video + Máº«u chá»§ Ä‘á» nhanh -->
        <label class="block">
          <div class="text-sm font-medium text-slate-700 mb-1">Chá»§ Ä‘á» video</div>
          <input id="topic" class="w-full rounded-xl border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-slate-300" placeholder="AI giÃºp há»c sinh tiá»ƒu há»c há»c ToÃ¡n nhanh hÆ¡n"/>
          <div class="mt-2 grid grid-cols-1 sm:grid-cols-2 gap-3">
            <label class="block">
              <div class="text-xs font-medium text-slate-600 mb-1">Máº«u chá»§ Ä‘á» nhanh</div>
              <select id="topicPreset" class="w-full rounded-xl border border-slate-300 px-3 py-2">
                <option value="">â€” Chá»n má»™t vÃ­ dá»¥ â€”</option>
                <option>AI giÃºp há»c sinh tiá»ƒu há»c há»c ToÃ¡n nhanh hÆ¡n</option>
                <option>9 chiáº¿n thuáº­t ká»ƒ chuyá»‡n giÃºp video YouTube tÄƒng giá»¯ chÃ¢n</option>
                <option>HDPE: LÃ³t há»“ tÆ°á»›i tiáº¿t kiá»‡m chi phÃ­ vÃ  chá»‘ng rÃ² rá»‰</option>
                <option>Luáº­t Äáº¥t Ä‘ai 2024: 5 bÆ°á»›c xin cáº¥p sá»• láº§n Ä‘áº§u dá»… hiá»ƒu</option>
                <option>VNIndex & sÃ³ng Elliott: Hai ká»‹ch báº£n 30 ngÃ y tá»›i</option>
                <option>Trump Brand: TÃªn tuá»•i Ä‘Ã¡ng giÃ¡ hÆ¡n vÃ ng?</option>
                <option>Pháº­t phÃ¡p á»©ng dá»¥ng: 3 thÃ³i quen giáº£m cÄƒng tháº³ng má»—i ngÃ y</option>
                <option>Real Estate Quy NhÆ¡n: Chá»n cÄƒn há»™ theo 7 tiÃªu chÃ­ cá»‘t lÃµi</option>
              </select>
            </label>
            <div class="flex items-end">
              <button id="applyTopicPreset" class="px-3 py-2 rounded-xl border border-slate-300 text-sm hover:bg-slate-50 w-full">DÃ¹ng máº«u chá»§ Ä‘á»</button>
            </div>
          </div>
          <div class="text-xs text-slate-500 mt-2">Chá»n tá»« â€œMáº«u chá»§ Ä‘á» nhanhâ€ Ä‘á»ƒ tá»± Ä‘á»™ng Ä‘iá»n â€“ ná»™i dung gá»£i Ã½ phÃ­a dÆ°á»›i sáº½ Ä‘á»“ng bá»™ theo lÄ©nh vá»±c.</div>
        </label>

        <!-- Äá»‘i tÆ°á»£ng chÃ­nh + Máº«u Ä‘á»‘i tÆ°á»£ng nhanh -->
        <label class="block">
          <div class="text-sm font-medium text-slate-700 mb-1">Äá»‘i tÆ°á»£ng chÃ­nh</div>
          <select id="audience" class="w-full rounded-xl border border-slate-300 px-3 py-2">
            <option>Phá»¥ huynh cÃ³ con cáº¥p 1</option>
            <option>NgÆ°á»i má»›i há»c AI</option>
            <option>NhÃ  Ä‘áº§u tÆ° ná»™i dung</option>
            <option>Há»c sinh THCS</option>
            <option>NhÃ  Ä‘áº§u tÆ° chá»©ng khoÃ¡n cÃ¡ nhÃ¢n</option>
            <option>KhÃ¡ch hÃ ng báº¥t Ä‘á»™ng sáº£n Quy NhÆ¡n</option>
            <option>KhÃ¡ch hÃ ng cáº§n giáº£i phÃ¡p mÃ ng chá»‘ng tháº¥m HDPE</option>
            <option>NgÆ°á»i quan tÃ¢m phÃ¡t triá»ƒn báº£n thÃ¢n & Pháº­t phÃ¡p</option>
          </select>

          <div class="mt-2 grid grid-cols-1 sm:grid-cols-2 gap-3">
            <label class="block">
              <div class="text-xs font-medium text-slate-600 mb-1">Máº«u Ä‘á»‘i tÆ°á»£ng nhanh</div>
              <select id="audiencePreset" class="w-full rounded-xl border border-slate-300 px-3 py-2">
                <option value="">â€” Chá»n má»™t vÃ­ dá»¥ â€”</option>
                <option>Phá»¥ huynh cÃ³ con cáº¥p 1</option>
                <option>NgÆ°á»i má»›i há»c AI</option>
                <option>NhÃ  Ä‘áº§u tÆ° chá»©ng khoÃ¡n cÃ¡ nhÃ¢n</option>
                <option>KhÃ¡ch hÃ ng báº¥t Ä‘á»™ng sáº£n Quy NhÆ¡n</option>
                <option>Chá»§ trang tráº¡i/nhÃ  mÃ¡y cáº§n HDPE</option>
                <option>Doanh nhÃ¢n tráº» 20â€“35 tuá»•i</option>
                <option>Phá»¥ huynh quan tÃ¢m an toÃ n sá»‘ cho con</option>
                <option>NgÆ°á»i thá»±c hÃ nh chÃ¡nh niá»‡m</option>
              </select>
            </label>
            <div class="flex items-end">
              <button id="applyAudiencePreset" class="px-3 py-2 rounded-xl border border-slate-300 text-sm hover:bg-slate-50 w-full">DÃ¹ng máº«u Ä‘á»‘i tÆ°á»£ng</button>
            </div>
          </div>
          <div class="text-xs text-slate-500 mt-2">Chá»n nhanh â€œMáº«u Ä‘á»‘i tÆ°á»£ngâ€ â€“ ná»™i dung báº±ng chá»©ng, CTA sáº½ tá»± Ä‘iá»u chá»‰nh phÃ¹ há»£p nhÃ³m ngÆ°á»i xem.</div>
        </label>

        <label class="block">
          <div class="text-sm font-medium text-slate-700 mb-1">Má»¥c tiÃªu video</div>
          <input id="goal" class="w-full rounded-xl border border-slate-300 px-3 py-2" placeholder="giÃºp khÃ¡n giáº£ Ã¡p dá»¥ng Ä‘Æ°á»£c ngay"/>
        </label>

        <label class="block">
          <div class="text-sm font-medium text-slate-700 mb-1">Ná»n táº£ng / Thá»i lÆ°á»£ng gá»£i Ã½</div>
          <select id="platform" class="w-full rounded-xl border border-slate-300 px-3 py-2">
            <option value="yt">YouTube (8â€“12 phÃºt)</option>
            <option value="shorts" selected>Shorts/Reels (45â€“60s)</option>
            <option value="tiktok">TikTok (60â€“120s)</option>
            <option value="pod">Podcast video (15â€“30p)</option>
          </select>
        </label>

        <label class="block">
          <div class="text-sm font-medium text-slate-700 mb-1">TÃ´ng giá»ng</div>
          <select id="tone" class="w-full rounded-xl border border-slate-300 px-3 py-2">
            <option>áº¤m Ã¡p</option>
            <option>DÃ­ dá»m</option>
            <option>Trá»±c diá»‡n</option>
            <option selected>Truyá»n cáº£m há»©ng</option>
            <option>HÃ i hÆ°á»›c</option>
            <option>Ká»‹ch tÃ­nh</option>
          </select>
        </label>

        <label class="block">
          <div class="text-sm font-medium text-slate-700 mb-1">TÃ i sáº£n báº±ng chá»©ng (phÃ¢n tÃ¡ch báº±ng dáº¥u pháº©y)</div>
          <input id="proofAssets" class="w-full rounded-xl border border-slate-300 px-3 py-2" value="áº¢nh trÆ°á»›c/sau, Feedback khÃ¡ch hÃ ng, Biá»ƒu Ä‘á»“ káº¿t quáº£"/>
          <div class="text-xs text-slate-500 mt-1">VD: áº¢nh trÆ°á»›c/sau, Feedback khÃ¡ch hÃ ng, Biá»ƒu Ä‘á»“ káº¿t quáº£, Video thá»±c hÃ nh</div>
        </label>
      </div>

      <div class="h-px bg-slate-200 my-6"></div>

      <div id="chips" class="flex flex-wrap gap-2 items-center text-sm"></div>

      <div class="mt-6 flex gap-2 flex-wrap">
        <button id="generateBtn" class="px-4 py-2 rounded-xl bg-slate-900 text-white text-sm hover:opacity-90">Táº¡o gá»£i Ã½ 9 chiáº¿n thuáº­t</button>
        <button id="randomBtn" class="px-4 py-2 rounded-xl border text-sm hover:bg-slate-50">Random chá»§ Ä‘á» & Ä‘á»‘i tÆ°á»£ng</button>
      </div>
    </section>

    <!-- Results -->
    <div id="results" class="space-y-6"></div>

    <footer class="text-center text-xs text-slate-500 pt-6 pb-12">StoryFlow 9 â€¢ Kallaway-inspired â€¢ HTML + Tailwind + Vanilla JS â€¢ Context-Aware</footer>
  </main>

  <script>
    // ====== Helpers & Presets ======
    const $ = (id) => document.getElementById(id);

    const topicExamples = [
      "AI giÃºp há»c sinh tiá»ƒu há»c há»c ToÃ¡n nhanh hÆ¡n",
      "9 chiáº¿n thuáº­t ká»ƒ chuyá»‡n giÃºp video YouTube tÄƒng giá»¯ chÃ¢n",
      "HDPE: LÃ³t há»“ tÆ°á»›i tiáº¿t kiá»‡m chi phÃ­ vÃ  chá»‘ng rÃ² rá»‰",
      "Luáº­t Äáº¥t Ä‘ai 2024: 5 bÆ°á»›c xin cáº¥p sá»• láº§n Ä‘áº§u dá»… hiá»ƒu",
      "VNIndex & sÃ³ng Elliott: Hai ká»‹ch báº£n 30 ngÃ y tá»›i",
      "Trump Brand: TÃªn tuá»•i Ä‘Ã¡ng giÃ¡ hÆ¡n vÃ ng?",
      "Pháº­t phÃ¡p á»©ng dá»¥ng: 3 thÃ³i quen giáº£m cÄƒng tháº³ng má»—i ngÃ y",
      "Real Estate Quy NhÆ¡n: Chá»n cÄƒn há»™ theo 7 tiÃªu chÃ­ cá»‘t lÃµi"
    ];

    const audienceExamples = [
      "Phá»¥ huynh cÃ³ con cáº¥p 1",
      "NgÆ°á»i má»›i há»c AI",
      "NhÃ  Ä‘áº§u tÆ° ná»™i dung",
      "Há»c sinh THCS",
      "NhÃ  Ä‘áº§u tÆ° chá»©ng khoÃ¡n cÃ¡ nhÃ¢n",
      "KhÃ¡ch hÃ ng báº¥t Ä‘á»™ng sáº£n Quy NhÆ¡n",
      "KhÃ¡ch hÃ ng cáº§n giáº£i phÃ¡p mÃ ng chá»‘ng tháº¥m HDPE",
      "NgÆ°á»i quan tÃ¢m phÃ¡t triá»ƒn báº£n thÃ¢n & Pháº­t phÃ¡p"
    ];

    const platformSpecs = {
      yt:  { label: "YouTube (8â€“12 phÃºt)", switchSec: 4 },
      shorts: { label: "Shorts/Reels (45â€“60s)", switchSec: 3 },
      tiktok: { label: "TikTok (60â€“120s)", switchSec: 3 },
      pod: { label: "Podcast video (15â€“30p)", switchSec: 6 },
    };

    const sentence = (s) => {
      const t = (s || "").trim();
      if (!t) return "";
      const last = t.slice(-1);
      return ".!?".includes(last) ? t : t + ".";
    };

    const makeChip = (text) => {
      const span = document.createElement("span");
      span.className = "inline-flex items-center rounded-full border border-slate-300 px-2.5 py-1 text-xs font-medium text-slate-700 bg-white";
      span.textContent = text;
      return span;
    };

    const sectionCard = ({badge, title, html}) => {
      const wrap = document.createElement("section");
      wrap.className = "bg-white/80 backdrop-blur rounded-2xl shadow-sm border border-slate-200 p-5 md:p-6 fade-in";
      wrap.innerHTML = `
        <div class="flex items-start gap-3 mb-3">
          <div class="h-9 w-9 shrink-0 rounded-xl bg-slate-900 text-white flex items-center justify-center text-sm font-semibold">${badge}</div>
          <h3 class="text-xl md:text-2xl font-semibold text-slate-800 leading-tight">${title}</h3>
        </div>
        <div class="prose prose-slate max-w-none text-sm md:text-base">${html}</div>
      `;
      return wrap;
    };

    const ul = (items) => `<ul>${items.map(t => `<li>${t}</li>`).join("")}</ul>`;

    // ====== Domain Packs (Topic) ======
    function topicPack(topic) {
      const t = topic.toLowerCase();

      // AI há»c sinh
      if (t.includes("ai") && (t.includes("há»c sinh") || t.includes("toÃ¡n") || t.includes("tiá»ƒu há»c"))) {
        return {
          metaphors: [
            "AI nhÆ° â€˜gia sÆ° vÃ´ hÃ¬nhâ€™ 24/7 â€“ luÃ´n sáºµn sÃ ng khi con cáº§n",
            "Báº£n Ä‘á»“ há»c táº­p: má»¥c tiÃªu â†’ lá»™ trÃ¬nh â†’ pháº£n há»“i tá»©c thÃ¬",
            "Thang mÃ¡y nÄƒng lá»±c: bÆ°á»›c vÃ o lÃ  tÄƒng tá»‘c, nhÆ°ng váº«n pháº£i â€˜báº¥m táº§ng Ä‘Ãºngâ€™"
          ],
          proof: ["Video con lÃ m bÃ i vá»›i ChatGPT", "áº¢nh Ä‘iá»ƒm sá»‘ trÆ°á»›c/sau", "Nháº­t kÃ½ há»c 7 ngÃ y", "Feedback cá»§a phá»¥ huynh/giÃ¡o viÃªn"],
          broll: ["BÃ© gÃµ ChatGPT", "Cáº­n cáº£nh bÃ i ToÃ¡n Ä‘Æ°á»£c giáº£i tá»«ng bÆ°á»›c", "Biá»ƒu Ä‘á»“ tiáº¿n bá»™ 1 tuáº§n", "Khoáº£nh kháº¯c bÃ© â€˜Wow!â€™"],
          thumb: ["AI LÃ€ GIA SÆ¯?", "Äiá»ƒm +3 Tuáº§n!", "Há»c Nhanh Gáº¥p 3"],
          outlineSteps: ["Chá»n dáº¡ng bÃ i", "Nháº­p cÃ¢u há»i tá»‘t", "Kiá»ƒm chá»©ng â€“ luyá»‡n biáº¿n thá»ƒ"]
        };
      }

      // HDPE
      if (t.includes("hdpe") || t.includes("lÃ³t há»“") || t.includes("chá»‘ng rÃ² rá»‰")) {
        return {
          metaphors: [
            "HDPE nhÆ° â€˜Ã¡o giÃ¡pâ€™ chá»‘ng rÃ² rá»‰ cho há»“", 
            "Tiá»n tháº¥t thoÃ¡t nhÆ° nÆ°á»›c qua káº½ ná»©t â€“ HDPE lÃ  nÃºt cháº·n",
            "â€˜Báº£o hiá»ƒm mÃ´i trÆ°á»ngâ€™ â€“ tráº£ phÃ­ má»™t láº§n, yÃªn tÃ¢m nhiá»u nÄƒm"
          ],
          proof: ["áº¢nh cÃ´ng trÃ¬nh trÆ°á»›c/sau", "Clip test má»‘i hÃ n", "Báº£ng chi phÃ­ tiáº¿t kiá»‡m/nÄƒm", "Ã kiáº¿n ká»¹ sÆ° giÃ¡m sÃ¡t"],
          broll: ["Cáº¯t â€“ tráº£i â€“ hÃ n mÃ ng", "Test má»‘i hÃ n chá»“ng mÃ­", "Äá»“ng há»“ lÆ°u lÆ°á»£ng rÃ² rá»‰ = 0", "ToÃ n cáº£nh há»“ sau 3â€“6 thÃ¡ng"],
          thumb: ["Há»’ KHÃ”NG RÃ’ Rá»ˆ", "TIáº¾T KIá»†M 30%", "Bá»€N 10â€“15 NÄ‚M"],
          outlineSteps: ["Kháº£o sÃ¡t & Ä‘o Ä‘áº¡c", "Chuáº©n bá»‹ ná»n", "Tráº£i & hÃ n", "Nghiá»‡m thu & báº£o trÃ¬"]
        };
      }

      // Luáº­t Ä‘áº¥t Ä‘ai
      if (t.includes("luáº­t Ä‘áº¥t") || t.includes("sá»•") || t.includes("cáº¥p sá»•") || t.includes("giáº¥y chá»©ng nháº­n")) {
        return {
          metaphors: [
            "Checklist phÃ¡p lÃ½ nhÆ° â€˜báº£n Ä‘á»“ kho bÃ¡uâ€™ â€“ thiáº¿u máº£nh nÃ o lÃ  láº¡c",
            "Há»“ sÆ¡ nhÆ° â€˜bá»™ puzzleâ€™ â€“ Ä‘áº·t Ä‘Ãºng vá»‹ trÃ­ lÃ  khá»›p ngay",
            "HÃ nh trÃ¬nh 5 tráº¡m â€“ ná»™p â†’ kiá»ƒm â†’ bá»• sung â†’ phÃª â†’ nháº­n"
          ],
          proof: ["Máº«u Ä‘Æ¡n & tá» khai", "Minh há»a timeline xá»­ lÃ½", "BiÃªn nháº­n há»“ sÆ¡", "Case thá»±c táº¿ táº¡i Ä‘á»‹a phÆ°Æ¡ng"],
          broll: ["Chá»¥p há»“ sÆ¡ máº«u", "Giao diá»‡n Cá»•ng DVCQG", "Phiáº¿u tiáº¿p nháº­n", "Quy trÃ¬nh xá»­ lÃ½ trÃªn báº£ng"],
          thumb: ["Cáº¤P Sá»” Dá»„", "5 BÆ¯á»šC Gá»ŒN", "KHÃ”NG Láº C Há»’ SÆ "],
          outlineSteps: ["Äiá»u kiá»‡n", "Há»“ sÆ¡", "CÃ¡ch ná»™p", "Lá»‡ phÃ­", "Theo dÃµi & nháº­n"]
        };
      }

      // Chá»©ng khoÃ¡n / VNIndex & Elliott
      if (t.includes("vnindex") || t.includes("elliott") || t.includes("chá»©ng khoÃ¡n")) {
        return {
          metaphors: [
            "SÃ³ng Elliott nhÆ° â€˜nhá»‹p timâ€™ thá»‹ trÆ°á»ng â€“ khá»e/yáº¿u nhÃ¬n nhá»‹p",
            "Fibo lÃ  â€˜thÆ°á»›c Ä‘oâ€™ nhá»‹p thá»Ÿ cá»§a giÃ¡",
            "Ká»‹ch báº£n A/B nhÆ° báº£n Ä‘á»“ 2 lá»‘i ráº½ â€“ chuáº©n bá»‹ trÆ°á»›c khi tá»›i ngÃ£ ba"
          ],
          proof: ["Biá»ƒu Ä‘á»“ cÃ³ Ä‘Ã¡nh sÃ³ng", "Fibo retracement cÃ¡c má»‘c", "Backtest 30â€“90 ngÃ y", "Nháº­t kÃ½ giao dá»‹ch"],
          broll: ["Zoom chart Daily/Weekly", "ÄÃ¡nh dáº¥u sÃ³ng 1â€“5/ABC", "Báº£ng má»©c Fibo 0.382â€“0.618", "So sÃ¡nh 2 ká»‹ch báº£n"],
          thumb: ["SÃ“NG LÃŠN?", "FIBO 0.5?", "2 Ká»ŠCH Báº¢N"],
          outlineSteps: ["Khung thá»i gian", "ÄÃ¡nh sá»‘ sÃ³ng", "Má»‘c Fibo", "Ká»‹ch báº£n & quáº£n trá»‹ rá»§i ro"]
        };
      }

      // Branding / Trump
      if (t.includes("trump") || t.includes("brand") || t.includes("thÆ°Æ¡ng hiá»‡u")) {
        return {
          metaphors: [
            "ThÆ°Æ¡ng hiá»‡u nhÆ° â€˜Ä‘á»‹nh giÃ¡ cá»• phiáº¿u cÃ¡ nhÃ¢nâ€™ â€“ ká»³ vá»ng táº¡o giÃ¡",
            "Tiáº¿ng vang truyá»n thÃ´ng lÃ  â€˜Ä‘Ã²n báº©yâ€™ tÄƒng Ä‘á»‹nh giÃ¡",
            "TÃ i sáº£n biá»ƒu tÆ°á»£ng (signature) nhÆ° logo sá»‘ng"
          ],
          proof: ["Case PR/earned media", "KPI reach/engagement", "So sÃ¡nh trÆ°á»›c/sau rebranding", "CÃ¢u chuyá»‡n bÃ¡o chÃ­ lá»›n"],
          broll: ["TiÃªu Ä‘á» bÃ¡o chÃ­", "Äá»“ thá»‹ tÃ¬m kiáº¿m Google Trends", "Cáº£nh sá»± kiá»‡n/Ä‘áº¥u giÃ¡", "Bá»™ nháº­n diá»‡n/tháº» tÃªn"],
          thumb: ["TÃŠN = TIá»€N?", "Äá»ŠNH GIÃ Báº¢N THÃ‚N", "TRUYá»€N THÃ”NG 4D"],
          outlineSteps: ["TuyÃªn ngÃ´n thÆ°Æ¡ng hiá»‡u", "TÃ i sáº£n biá»ƒu tÆ°á»£ng", "Chiáº¿n lÆ°á»£c truyá»n thÃ´ng", "ThÆ°á»›c Ä‘o & tá»‘i Æ°u"]
        };
      }

      // Pháº­t phÃ¡p á»©ng dá»¥ng
      if (t.includes("pháº­t") || t.includes("chÃ¡nh niá»‡m") || t.includes("giáº£m cÄƒng tháº³ng")) {
        return {
          metaphors: [
            "TÃ¢m nhÆ° máº·t há»“ â€“ Ä‘á»™ng vÃ¬ giÃ³ vá»ng tÆ°á»Ÿng",
            "HÆ¡i thá»Ÿ lÃ  sá»£i dÃ¢y kÃ©o ta vá» hiá»‡n táº¡i",
            "ThÃ³i quen nhÆ° giá»t nÆ°á»›c â€“ tá»«ng giá»t thÃ nh há»“ an á»•n"
          ],
          proof: ["Nháº­t kÃ½ hÃ nh thiá»n 7â€“14 ngÃ y", "Thang Ä‘iá»ƒm cÄƒng tháº³ng trÆ°á»›c/sau", "Chia sáº» chuyá»ƒn hÃ³a cÃ¡ nhÃ¢n", "TrÃ­ch dáº«n/kinh nghiá»‡m cá»§a Tháº§y"],
          broll: ["Cáº£nh thá»Ÿ cháº­m", "Ãnh sÃ¡ng bÃ¬nh minh", "Viáº¿t nháº­t kÃ½ 3 dÃ²ng", "Ná»¥ cÆ°á»i thÆ° thÃ¡i"],
          thumb: ["TÄ¨NH 5 PHÃšT", "HÆ I THá» CHá»®A LÃ€NH", "Háº  CÄ‚NG THáº²NG"],
          outlineSteps: ["Thá»±c táº­p 3-3-3", "QuÃ¡n chiáº¿u 1 Ä‘iá»u", "HÃ nh Ä‘á»™ng nhá» nuÃ´i dÆ°á»¡ng"]
        };
      }

      // BÄS Quy NhÆ¡n
      if (t.includes("quy nhÆ¡n") || t.includes("cÄƒn há»™") || t.includes("real estate")) {
        return {
          metaphors: [
            "Mua nhÃ  nhÆ° â€˜chá»n tá»• áº¥mâ€™ â€“ 7 tiÃªu chÃ­ lÃ  khung xÆ°Æ¡ng",
            "Vá»‹ trÃ­ lÃ  â€˜trá»¥c xÆ°Æ¡ng sá»‘ngâ€™ â€“ cÃ²n láº¡i lÃ  cÆ¡ báº¯p",
            "PhÃ¡p lÃ½ lÃ  â€˜lÃ¡ cháº¯nâ€™ â€“ an cÆ° má»›i láº¡c nghiá»‡p"
          ],
          proof: ["So sÃ¡nh dá»± Ã¡n A/B/C", "Báº£ng phÃ¡p lÃ½ tá»«ng dá»± Ã¡n", "GiÃ¡/tiá»‡n Ã­ch/tiáº¿n Ä‘á»™", "Feedback cÆ° dÃ¢n/khÃ¡ch Ä‘Ã£ mua"],
          broll: ["Flycam vá»‹ trÃ­", "Interior tour cÄƒn máº«u", "Báº£ng tiá»‡n Ã­ch dá»± Ã¡n", "Báº£n Ä‘á»“ káº¿t ná»‘i háº¡ táº§ng"],
          thumb: ["CHá»ŒN ÄÃšNG NHÃ€", "7 TIÃŠU CHÃ VÃ€NG", "PHÃP LÃ AN TÃ‚M"],
          outlineSteps: ["Vá»‹ trÃ­ â€“ káº¿t ná»‘i", "PhÃ¡p lÃ½ â€“ uy tÃ­n CÄT", "Tiá»‡n Ã­ch â€“ cá»™ng Ä‘á»“ng", "GiÃ¡ â€“ tiáº¿n Ä‘á»™ â€“ tiá»m nÄƒng"]
        };
      }

      // Máº·c Ä‘á»‹nh (YouTube storytelling)
      return {
        metaphors: [
          "CÃ¢u chuyá»‡n lÃ  â€˜chiáº¿c cáº§uâ€™ ná»‘i Ã½ tÆ°á»Ÿng vá»›i cáº£m xÃºc",
          "Nhá»‹p hÃ¬nh nhÆ° â€˜trá»‘ng tráº­nâ€™ â€“ giá»¯ Ä‘á»™i hÃ¬nh khÃ´ng rÃ£",
          "GiÃ¡ trá»‹ Ä‘áº§u video lÃ  â€˜vÃ© vÃ o cá»­aâ€™ cho pháº§n sau"
        ],
        proof: ["VÃ­ dá»¥ kÃªnh tÆ°Æ¡ng tá»±", "Biá»ƒu Ä‘á»“ retention", "A/B test hook", "Case há»c viÃªn/khÃ¡n giáº£"],
        broll: ["MÃ n hÃ¬nh video/analytics", "GÃ³c quay máº·t/over-shoulder", "Text Ä‘á»™ng nháº¥n Ã½", "Cut-in cáº£m xÃºc"],
        thumb: ["HOOK Tá»T = WIN", "GIá»® CHÃ‚N 50%+", "9 VÅ¨ KHÃ"],
        outlineSteps: ["Hook", "Bá»‘i cáº£nh", "NguyÃªn lÃ½", "Minh há»a", "CTA"]
      };
    }

    // ====== Audience Profiles ======
    function audienceProfile(aud) {
      const a = aud.toLowerCase();

      if (a.includes("phá»¥ huynh")) return {
        style: "Dá»… hiá»ƒu, áº¥m Ã¡p, an toÃ n cho tráº»",
        preferProof: ["Feedback giÃ¡o viÃªn", "Tiáº¿n bá»™ Ä‘iá»ƒm sá»‘", "Lá»‹ch há»c/lá»‹ch ngá»§ cÃ¢n báº±ng"],
        cta: "Comment tuá»•i vÃ  lá»›p cá»§a con â€“ nháº­n checklist Ã¡p dá»¥ng ngay hÃ´m nay."
      };
      if (a.includes("chá»©ng khoÃ¡n")) return {
        style: "Trá»±c diá»‡n, sá»‘ liá»‡u rÃµ, quáº£n trá»‹ rá»§i ro",
        preferProof: ["Chart Ä‘Ã¡nh dáº¥u Ä‘iá»ƒm vÃ o/ra", "Risk:Reward â‰¥ 1:2", "Backtest 30â€“90 ngÃ y"],
        cta: "Comment mÃ£ quan tÃ¢m â€“ mÃ¬nh gá»­i template ká»‹ch báº£n & quáº£n trá»‹ rá»§i ro."
      };
      if (a.includes("báº¥t Ä‘á»™ng sáº£n")) return {
        style: "Cá»¥ thá»ƒ, phÃ¡p lÃ½ trÆ°á»›c â€“ cáº£m xÃºc sau",
        preferProof: ["Sá»• máº«u/giáº¥y tá» phÃ¡p lÃ½", "GiÃ¡/tiáº¿n Ä‘á»™", "So sÃ¡nh dá»± Ã¡n lÃ¢n cáº­n"],
        cta: "Äá»ƒ láº¡i khu vá»±c & ngÃ¢n sÃ¡ch â€“ mÃ¬nh gá»­i báº£ng so sÃ¡nh 3 dá»± Ã¡n phÃ¹ há»£p."
      };
      if (a.includes("hdpe") || a.includes("trang tráº¡i") || a.includes("nhÃ  mÃ¡y")) return {
        style: "Ká»¹ thuáº­t rÃµ â€“ lá»£i Ã­ch tiá»n + mÃ´i trÆ°á»ng",
        preferProof: ["Test má»‘i hÃ n", "TÃ­nh toÃ¡n tiáº¿t kiá»‡m rÃ² rá»‰", "áº¢nh cÃ´ng trÃ¬nh 3â€“12 thÃ¡ng sau"],
        cta: "Nháº­p kÃ­ch thÆ°á»›c há»“ â€“ mÃ¬nh Æ°á»›c tÃ­nh chi phÃ­ & thá»i gian thi cÃ´ng."
      };
      if (a.includes("ai") || a.includes("há»c ai") || a.includes("nhÃ  Ä‘áº§u tÆ° ná»™i dung")) return {
        style: "Nhanh, demo trá»±c tiáº¿p, cÃ³ template",
        preferProof: ["TrÆ°á»›c/sau khi dÃ¹ng tool", "Káº¿t quáº£ retention/CTR", "Checklist quay dá»±ng"],
        cta: "GÃµ tá»« khÃ³a chá»§ Ä‘á» â€“ mÃ¬nh sinh ngay script + checklist quay."
      };
      if (a.includes("pháº­t") || a.includes("chÃ¡nh niá»‡m")) return {
        style: "Nháº¹ nhÃ ng, tráº£i nghiá»‡m tháº­t, khÃ´ng giÃ¡o Ä‘iá»u",
        preferProof: ["Nháº­t kÃ½ thá»±c táº­p", "Chá»‰ bÃ¡o giáº¥c ngá»§/cÄƒng tháº³ng", "TrÃ­ch dáº«n kinh nghiá»‡m Tháº§y"],
        cta: "Comment â€˜anâ€™ â€“ mÃ¬nh gá»­i audio 5 phÃºt thá»Ÿ chÃ¡nh niá»‡m má»—i ngÃ y."
      };

      return {
        style: "RÃµ rÃ ng, dá»… Ã¡p dá»¥ng, cÃ³ vÃ­ dá»¥",
        preferProof: ["VÃ­ dá»¥ thá»±c táº¿", "Minh há»a trá»±c quan", "Checklist hÃ nh Ä‘á»™ng"],
        cta: "Comment â€˜templateâ€™ â€“ mÃ¬nh gá»­i file máº«u Ä‘á»ƒ báº¡n Ã¡p dá»¥ng."
      };
    }

    // ====== Engine (build content with Packs) ======
    function buildEngine(input) {
      const { topic, audience, goal, platform, tone, proofAssets } = input;
      const p = platformSpecs[platform] || platformSpecs.shorts;
      const switchEvery = p.switchSec;

      const tPack = topicPack(topic);
      const aProf = audienceProfile(audience);

      // Merge proof assets: custom > audience-prefer > topic-pack default
      let mergedProof = [];
      const userProof = (proofAssets || "").split(/,\s*/g).filter(Boolean);
      if (userProof.length) mergedProof = userProof;
      else mergedProof = (aProf.preferProof || []).concat(tPack.proof || []);

      // 1) Comprehension Maxing
      const compMax = {
        speak: [
          `Trong video hÃ´m nay, chÃºng ta sáº½ nÃ³i vá»: ${topic}`,
          `Má»¥c tiÃªu: ${goal || "giÃºp khÃ¡n giáº£ Ã¡p dá»¥ng Ä‘Æ°á»£c ngay"}`,
          `Phong cÃ¡ch trÃ¬nh bÃ y: ${aProf.style}`
        ].map(sentence),
        visuals: [
          `Text má»Ÿ nÃªu chá»§ Ä‘á» "${topic}" + phá»¥ Ä‘á» 2â€“4 tá»« má»—i Ã½`,
          "VÃ­ dá»¥ thá»±c táº¿ 3â€“5 giÃ¢y minh há»a váº¥n Ä‘á»",
          "Overlay tá»« khÃ³a chÃ­nh khá»›p lá»i nÃ³i (2â€“4 tá»«)"
        ]
      };

      // 2) Hawkeye Narrative
      const hawkeye = {
        openContext: sentence(`Váº¥n Ä‘á» lá»›n cá»§a ${audience}: vÃ¬ sao ${topic.toLowerCase()} láº¡i quan trá»ng?`),
        deepen: [
          "Bá»‘i cáº£nh rá»™ng: dá»¯ liá»‡u/quan sÃ¡t phá»• quÃ¡t trong lÄ©nh vá»±c",
          "NguyÃªn lÃ½/lÃ½ thuyáº¿t cá»‘t lÃµi (Ä‘Æ¡n giáº£n hÃ³a)",
          "VÃ­ dá»¥ cá»¥ thá»ƒ & cÃ¡ch lÃ m tá»«ng bÆ°á»›c theo chá»§ Ä‘á»"
        ].map(sentence)
      };

      // 3) Metaphors
      const metaphors = tPack.metaphors || [
        "áº¨n dá»¥ chung: cÃ¢u chuyá»‡n lÃ  cÃ¢y cáº§u ná»‘i Ã½ tÆ°á»Ÿng vá»›i cáº£m xÃºc"
      ];

      // 4) Common Ground
      const commonGround = {
        opener: sentence("TÃ´i tá»«ng á»Ÿ vá»‹ trÃ­ cá»§a báº¡n: phÃ¢n vÃ¢n, sá»£ sai, vÃ  khÃ´ng biáº¿t báº¯t Ä‘áº§u tá»« Ä‘Ã¢u."),
        we: sentence("Khi chÃºng ta thá»­ má»™t cÃ¡ch tiáº¿p cáº­n má»›i, má»i thá»© báº¯t Ä‘áº§u thay Ä‘á»•i."),
        ref: sentence("Ngay sau Ä‘Ã¢y lÃ  vÃ­ dá»¥ Ä‘á»i thá»±c â€“ bÃ¡m theo chá»§ Ä‘á» vÃ  nhÃ³m ngÆ°á»i xem nÃ y.")
      };

      // 5) Simplify
      const simplify = [
        "Chia ná»™i dung thÃ nh 3 Ã½ cá»‘t lÃµi, má»—i Ã½ â‰¤ 1 cÃ¢u ngáº¯n",
        "TrÃ¡nh thuáº­t ngá»¯ â€“ náº¿u buá»™c dÃ¹ng, luÃ´n kÃ¨m vÃ­ dá»¥ bÃ¡m sÃ¡t chá»§ Ä‘á»",
        "CÃ¢u chá»§ Ä‘á»™ng, Ä‘á»™ng tá»« máº¡nh, sá»‘ liá»‡u trÃ²n dá»… nhá»›"
      ];

      // 6) Visual Stun
      const visualStun = {
        cadence: sentence(`Äá»•i khung hÃ¬nh má»—i ${switchEvery} giÃ¢y (cáº­n/medium/toÃ n, text, b-roll, mÃ n hÃ¬nh demo).`),
        edits: [
          "Jump cut theo máº¡ch Ã½ Ä‘á»ƒ giá»¯ nhá»‹p",
          "Slow Zoom 5â€“8% cho pháº§n giáº£i thÃ­ch quan trá»ng",
          `Insert b-roll chuyÃªn biá»‡t lÄ©nh vá»±c: ${ (tPack.broll||[]).slice(0,3).join(", ") }`
        ]
      };

      // 7) Value Compression
      const valueCompression = {
        first10s: [
          "NÃ³i lá»£i Ã­ch lá»›n nháº¥t ngay 5â€“10 giÃ¢y Ä‘áº§u",
          "Hiá»ƒn thá»‹ káº¿t quáº£/cuá»‘i Ä‘Æ°á»ng trÆ°á»›c, hÃ nh trÃ¬nh sau"
        ].map(sentence),
        sample: sentence(`â€œChá»‰ má»™t thay Ä‘á»•i nhá» hÃ´m nay, ${audience.toLowerCase()} sáº½ tháº¥y káº¿t quáº£ trong tuáº§n nÃ y.â€`)
      };

      // 8) Proof
      const proof = {
        copy: sentence("ÄÆ°a báº±ng chá»©ng tháº­t Ä‘á»ƒ táº¯t â€˜mÃ¡y dÃ² BSâ€™: áº£nh/video/sá»‘ liá»‡u/case study."),
        assets: mergedProof
      };

      // 9) Contrast
      const contrast = {
        template: sentence("Ká»³ vá»ng â†’ Báº» ngoáº·t â†’ Giáº£i thÃ­ch táº¡i sao â†’ Lá»£i Ã­ch báº¥t ngá»"),
        hooks: [
          "TÃ´i Ä‘Ã£ sai suá»‘t 3 nÄƒmâ€¦",
          "CÃ¡ch phá»• biáº¿n nháº¥t thá»±c ra láº¡i kÃ©m hiá»‡u quáº£ nháº¥t",
          "Äiá»u khÃ´ng ai nÃ³i cho báº¡n biáº¿tâ€¦"
        ]
      };

      // Outline (domain-specific)
      const outline = [
        { part: "Hook (0â€“10s)", content: [valueCompression.sample, contrast.hooks[1], compMax.speak[0]] },
        { part: "Bá»‘i cáº£nh (10â€“30s)", content: [hawkeye.openContext, commonGround.opener] },
        { part: "NguyÃªn lÃ½ (30â€“60s)", content: [metaphors[0] || "", simplify[0]] },
        { part: "CÃ¡ch lÃ m (1â€“3p)", content: (tPack.outlineSteps || ["BÆ°á»›c 1", "BÆ°á»›c 2", "BÆ°á»›c 3"]).map(s=>s) },
        { part: "Báº±ng chá»©ng (Ä‘an xen)", content: proof.assets },
        { part: "Káº¿t thÃºc/CTA", content: [aProf.cta] }
      ];

      // Visual helpers
      const thumb = tPack.thumb || ["HOOK Máº NH", "GIá»® CHÃ‚N 50%+", "9 VÅ¨ KHÃ"];
      const broll = tPack.broll || ["MÃ n hÃ¬nh minh há»a", "Text nháº¥n Ã½", "Cáº­n biá»ƒu cáº£m"];

      return { compMax, hawkeye, metaphors, commonGround, simplify, visualStun, valueCompression, proof, contrast, outline, thumb, broll, switchEvery, p, tone, topic, audience, goal, audienceStyle: aProf.style };
    }

    // ====== Render ======
    function renderAll(engine) {
      const out = $("results");
      out.innerHTML = "";

      const chips = $("chips");
      chips.innerHTML = "";
      chips.appendChild(makeChip("Chá»§ Ä‘á»: " + engine.topic));
      chips.appendChild(makeChip("Äá»‘i tÆ°á»£ng: " + engine.audience));
      chips.appendChild(makeChip("Má»¥c tiÃªu: " + engine.goal));
      chips.appendChild(makeChip("Ná»n táº£ng: " + engine.p.label));
      chips.appendChild(makeChip("TÃ´ng giá»ng: " + engine.tone));
      chips.appendChild(makeChip("Äá»•i khung hÃ¬nh má»—i " + engine.switchEvery + "s"));
      chips.appendChild(makeChip("Phong cÃ¡ch: " + engine.audienceStyle));

      const section = (b,t,h) => out.appendChild(sectionCard({badge:b,title:t,html:h}));

      section("1","Comprehension Maxing â€“ GhÃ©p lá»i nÃ³i vá»›i hÃ¬nh áº£nh",
        `<p class="font-medium">Lá»i thoáº¡i gá»£i Ã½:</p>${ul(engine.compMax.speak.map(s=>"ğŸ—£ï¸ "+s))}
         <div class="h-px bg-slate-200 my-4"></div>
         <p class="font-medium">HÃ¬nh áº£nh gá»£i Ã½:</p>${ul(engine.compMax.visuals.map(v=>"ğŸï¸ "+v))}`);

      section("2","Hawkeye Narrative â€“ Tá»« tá»•ng thá»ƒ Ä‘áº¿n chi tiáº¿t",
        `<p>${engine.hawkeye.openContext}</p><div class="mt-3">${ul(engine.hawkeye.deepen)}</div>`);

      section("3","Visual Examples & Metaphors â€“ áº¨n dá»¥ trá»±c quan",
        ul(engine.metaphors.map(m=>"ğŸ’¡ "+m)));

      section("4","Common Ground â€“ Äiá»ƒm chung vá»›i khÃ¡n giáº£",
        `<p>${engine.commonGround.opener}</p><p>${engine.commonGround.we}</p><p>${engine.commonGround.ref}</p>`);

      section("5","Simpler Words & Ideas â€“ Ngáº¯n gá»n vÃ  dá»… hiá»ƒu",
        ul(engine.simplify.map(s=>"âœï¸ "+s)));

      section("6","Visual Stun Gun â€“ Nhá»‹p hÃ¬nh giá»¯ chÃº Ã½",
        `<p>${engine.visualStun.cadence}</p><div class="mt-2">${ul(engine.visualStun.edits.map(e=>"ğŸ¬ "+e))}</div>`);

      section("7","Value Compression â€“ NÃ©n giÃ¡ trá»‹ lÃªn Ä‘áº§u",
        `<p class="font-medium">Trong 10 giÃ¢y Ä‘áº§u:</p>${ul(engine.valueCompression.first10s.map(v=>"âš¡ "+v))}
         <p class="mt-2">CÃ¢u máº«u: <span class="font-semibold">${engine.valueCompression.sample}</span></p>`);

      section("8","Come With Proof â€“ ÄÆ°a báº±ng chá»©ng tháº­t",
        `<p>${engine.proof.copy}</p><div class="mt-2">${ul(engine.proof.assets.map(a=>"ğŸ“ "+a))}</div>`);

      section("9","Set Up Contrast â€“ Táº¡o tÆ°Æ¡ng pháº£n & báº¥t ngá»",
        `<p>Máº«u cáº¥u trÃºc: ${engine.contrast.template}</p>
         <div class="flex flex-wrap gap-2 mt-3">
           ${engine.contrast.hooks.map(h=>`<span class="px-2 py-1 rounded-full bg-slate-100 text-slate-700 text-xs border border-slate-200">${h}</span>`).join("")}
         </div>`);

      // Outline
      const rows = engine.outline.map(row => `
        <tr class="odd:bg-white even:bg-slate-50">
          <td class="align-top p-3 border-b w-48 font-medium">${row.part}</td>
          <td class="align-top p-3 border-b">${ul(row.content)}</td>
        </tr>
      `).join("");
      section("ğŸ“œ","TÃ³m táº¯t ká»‹ch báº£n Ä‘á» xuáº¥t",
        `<div class="overflow-x-auto">
           <table class="w-full text-sm border border-slate-200 rounded-xl overflow-hidden">
             <thead class="bg-slate-50">
               <tr><th class="text-left p-3 border-b">Pháº§n</th><th class="text-left p-3 border-b">Ná»™i dung</th></tr>
             </thead>
             <tbody>${rows}</tbody>
           </table>
         </div>`);

      // Thumb & B-roll
      section("ğŸ–¼ï¸","Gá»£i Ã½ Thumbnail", ul(engine.thumb));
      section("ğŸï¸","Danh sÃ¡ch B-roll Ä‘á» xuáº¥t", ul(engine.broll));

      // Openers by tone
      section("ğŸ™ï¸","Gá»£i Ã½ lá»i thoáº¡i má»Ÿ Ä‘áº§u (theo tÃ´ng giá»ng)",
        ul([
          `<b>Hook tÆ°Æ¡ng pháº£n:</b> "TÃ´i tá»«ng nghÄ© ${engine.topic.toLowerCase()} lÃ  Ã½ tÆ°á»Ÿng tá»‡ â€” cho Ä‘áº¿n khi tháº¥y káº¿t quáº£."`,
          `<b>GiÃ¡ trá»‹ tá»©c thÃ¬:</b> "Trong 60 giÃ¢y, báº¡n sáº½ cÃ³ 3 bÆ°á»›c Ä‘á»ƒ ${engine.goal}."`,
          `<b>Báº±ng chá»©ng lá»“ng ghÃ©p:</b> "ÄÃ¢y lÃ  minh chá»©ng tháº­t tá»« ${engine.audience.toLowerCase()} tuáº§n trÆ°á»›c."`
        ]));
    }

    // ====== IO & Events ======
    const defaults = {
      topic: topicExamples[0],
      audience: audienceExamples[0],
      goal: "giÃºp khÃ¡n giáº£ Ã¡p dá»¥ng Ä‘Æ°á»£c ngay",
      platform: "shorts",
      tone: "Truyá»n cáº£m há»©ng",
      proofAssets: "áº¢nh trÆ°á»›c/sau, Feedback khÃ¡ch hÃ ng, Biá»ƒu Ä‘á»“ káº¿t quáº£"
    };

    function setDefaults() {
      $("topic").value = defaults.topic;
      $("audience").value = defaults.audience;
      $("goal").value = defaults.goal;
      $("platform").value = defaults.platform;
      $("tone").value = defaults.tone;
      $("proofAssets").value = defaults.proofAssets;
      $("topicPreset").value = "";
      $("audiencePreset").value = "";
    }

    function readInput() {
      return {
        topic: $("topic").value.trim() || defaults.topic,
        audience: $("audience").value,
        goal: $("goal").value.trim() || defaults.goal,
        platform: $("platform").value,
        tone: $("tone").value,
        proofAssets: $("proofAssets").value.trim()
      };
    }

    async function copyJson() {
      const input = readInput();
      const data = buildEngine(input);
      const payload = { input, data, topicExamples, audienceExamples };
      await navigator.clipboard.writeText(JSON.stringify(payload, null, 2));
      alert("ÄÃ£ sao chÃ©p cáº¥u hÃ¬nh + gá»£i Ã½ ra clipboard!");
    }

    // Buttons
    $("generateBtn").addEventListener("click", () => {
      const engine = buildEngine(readInput());
      renderAll(engine);
      window.scrollTo({ top: document.body.scrollHeight, behavior: "smooth" });
    });

    $("resetBtn").addEventListener("click", () => {
      setDefaults();
      $("results").innerHTML = "";
      $("chips").innerHTML = "";
    });

    $("copyJsonBtn").addEventListener("click", copyJson);

    $("applyTopicPreset").addEventListener("click", () => {
      const val = $("topicPreset").value;
      if (val) $("topic").value = val;
    });

    $("applyAudiencePreset").addEventListener("click", () => {
      const val = $("audiencePreset").value;
      if (val) $("audience").value = val;
    });

    $("randomBtn").addEventListener("click", () => {
      const t = topicExamples[Math.floor(Math.random()*topicExamples.length)];
      const a = audienceExamples[Math.floor(Math.random()*audienceExamples.length)];
      $("topic").value = t;
      $("audience").value = a;
    });

    // Boot
    setDefaults();
  </script>
</body>
</html>
