<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>StoryFlow 9 – Kallaway Storytelling Coach (HTML)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <meta name="description" content="StoryFlow 9 – Trợ lý kể chuyện theo 9 chiến thuật Kallaway" />
  <style>
    .prose ul { list-style: disc; padding-left: 1.25rem; }
    .fade-in { animation: fade .25s ease-in; }
    @keyframes fade { from {opacity: .0; transform: translateY(3px)} to {opacity:1; transform: translateY(0)} }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-b from-slate-50 to-slate-100 text-slate-800">
  <!-- Header -->
  <header class="sticky top-0 z-10 bg-white/80 backdrop-blur border-b border-slate-200">
    <div class="mx-auto max-w-6xl px-4 py-4 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="h-9 w-9 rounded-xl bg-slate-900 text-white grid place-items-center font-bold">SF</div>
        <div>
          <h1 class="text-lg md:text-xl font-semibold">StoryFlow 9</h1>
          <p class="text-xs text-slate-500 -mt-0.5">Trợ lý kể chuyện – 9 chiến thuật vàng (Kallaway)</p>
        </div>
      </div>
      <div class="flex items-center gap-2">
        <button id="copyJsonBtn" class="px-3 py-1.5 rounded-lg bg-slate-900 text-white text-sm hover:opacity-90">Sao chép JSON</button>
        <button id="resetBtn" className="px-3 py-1.5 rounded-lg border text-sm">Reset</button>
      </div>
    </div>
  </header>

  <main class="mx-auto max-w-6xl px-4 py-8 space-y-8">
    <!-- Controls -->
    <section class="bg-white/80 backdrop-blur rounded-2xl shadow-sm border border-slate-200 p-5 md:p-6">
      <div class="flex items-start gap-3 mb-3">
        <div class="h-9 w-9 shrink-0 rounded-xl bg-slate-900 text-white flex items-center justify-center text-sm font-semibold">⚙️</div>
        <h2 class="text-xl md:text-2xl font-semibold text-slate-800 leading-tight">Thiết lập nhanh</h2>
      </div>

      <div class="grid md:grid-cols-2 gap-5">
        <!-- Chủ đề video + Mẫu chủ đề nhanh -->
        <label class="block">
          <div class="text-sm font-medium text-slate-700 mb-1">Chủ đề video</div>
          <input id="topic" class="w-full rounded-xl border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-slate-300" placeholder="AI giúp học sinh tiểu học học Toán nhanh hơn"/>
          <div class="mt-2 grid grid-cols-1 sm:grid-cols-2 gap-3">
            <label class="block">
              <div class="text-xs font-medium text-slate-600 mb-1">Mẫu chủ đề nhanh</div>
              <select id="topicPreset" class="w-full rounded-xl border border-slate-300 px-3 py-2">
                <!-- 8 ví dụ đa lĩnh vực -->
                <option value="">— Chọn một ví dụ —</option>
                <option>AI giúp học sinh tiểu học học Toán nhanh hơn</option>
                <option>9 chiến thuật kể chuyện giúp video YouTube tăng giữ chân</option>
                <option>HDPE: Lót hồ tưới tiết kiệm chi phí và chống rò rỉ</option>
                <option>Luật Đất đai 2024: 5 bước xin cấp sổ lần đầu dễ hiểu</option>
                <option>VNIndex & sóng Elliott: Hai kịch bản 30 ngày tới</option>
                <option>Trump Brand: Tên tuổi đáng giá hơn vàng?</option>
                <option>Phật pháp ứng dụng: 3 thói quen giảm căng thẳng mỗi ngày</option>
                <option>Real Estate Quy Nhơn: Chọn căn hộ theo 7 tiêu chí cốt lõi</option>
              </select>
            </label>
            <div class="flex items-end">
              <button id="applyTopicPreset" class="px-3 py-2 rounded-xl border border-slate-300 text-sm hover:bg-slate-50 w-full">Dùng mẫu chủ đề</button>
            </div>
          </div>
          <div class="text-xs text-slate-500 mt-2">Chọn từ “Mẫu chủ đề nhanh” để tự động điền – sau đó bạn vẫn có thể chỉnh sửa.</div>
        </label>

        <!-- Đối tượng chính + Mẫu đối tượng nhanh -->
        <label class="block">
          <div class="text-sm font-medium text-slate-700 mb-1">Đối tượng chính</div>
          <select id="audience" class="w-full rounded-xl border border-slate-300 px-3 py-2">
            <!-- 8 ví dụ đối tượng -->
            <option>Phụ huynh có con cấp 1</option>
            <option>Người mới học AI</option>
            <option>Nhà đầu tư nội dung</option>
            <option>Học sinh THCS</option>
            <option>Nhà đầu tư chứng khoán cá nhân</option>
            <option>Khách hàng bất động sản Quy Nhơn</option>
            <option>Khách hàng cần giải pháp màng chống thấm HDPE</option>
            <option>Người quan tâm phát triển bản thân & Phật pháp</option>
          </select>

          <div class="mt-2 grid grid-cols-1 sm:grid-cols-2 gap-3">
            <label class="block">
              <div class="text-xs font-medium text-slate-600 mb-1">Mẫu đối tượng nhanh</div>
              <select id="audiencePreset" class="w-full rounded-xl border border-slate-300 px-3 py-2">
                <option value="">— Chọn một ví dụ —</option>
                <option>Phụ huynh có con cấp 1</option>
                <option>Người mới học AI</option>
                <option>Nhà đầu tư chứng khoán cá nhân</option>
                <option>Khách hàng bất động sản Quy Nhơn</option>
                <option>Chủ trang trại/nhà máy cần HDPE</option>
                <option>Doanh nhân trẻ 20–35 tuổi</option>
                <option>Phụ huynh quan tâm an toàn số cho con</option>
                <option>Người thực hành chánh niệm</option>
              </select>
            </label>
            <div class="flex items-end">
              <button id="applyAudiencePreset" class="px-3 py-2 rounded-xl border border-slate-300 text-sm hover:bg-slate-50 w-full">Dùng mẫu đối tượng</button>
            </div>
          </div>
          <div class="text-xs text-slate-500 mt-2">Bạn có thể chọn nhanh “Mẫu đối tượng” rồi vẫn chỉnh sửa trực tiếp.</div>
        </label>

        <label class="block">
          <div class="text-sm font-medium text-slate-700 mb-1">Mục tiêu video</div>
          <input id="goal" class="w-full rounded-xl border border-slate-300 px-3 py-2" placeholder="giúp khán giả áp dụng được ngay"/>
        </label>

        <label class="block">
          <div class="text-sm font-medium text-slate-700 mb-1">Nền tảng / Thời lượng gợi ý</div>
          <select id="platform" class="w-full rounded-xl border border-slate-300 px-3 py-2">
            <option value="yt">YouTube (8–12 phút)</option>
            <option value="shorts" selected>Shorts/Reels (45–60s)</option>
            <option value="tiktok">TikTok (60–120s)</option>
            <option value="pod">Podcast video (15–30p)</option>
          </select>
        </label>

        <label class="block">
          <div class="text-sm font-medium text-slate-700 mb-1">Tông giọng</div>
          <select id="tone" class="w-full rounded-xl border border-slate-300 px-3 py-2">
            <option>Ấm áp</option>
            <option>Dí dỏm</option>
            <option>Trực diện</option>
            <option selected>Truyền cảm hứng</option>
            <option>Hài hước</option>
            <option>Kịch tính</option>
          </select>
        </label>

        <label class="block">
          <div class="text-sm font-medium text-slate-700 mb-1">Tài sản bằng chứng (phân tách bằng dấu phẩy)</div>
          <input id="proofAssets" class="w-full rounded-xl border border-slate-300 px-3 py-2" value="Ảnh trước/sau, Feedback khách hàng, Biểu đồ kết quả"/>
          <div class="text-xs text-slate-500 mt-1">VD: Ảnh trước/sau, Feedback khách hàng, Biểu đồ kết quả, Video thực hành</div>
        </label>
      </div>

      <div class="h-px bg-slate-200 my-6"></div>

      <div id="chips" class="flex flex-wrap gap-2 items-center text-sm"></div>

      <div class="mt-6">
        <button id="generateBtn" class="px-4 py-2 rounded-xl bg-slate-900 text-white text-sm hover:opacity-90">Tạo gợi ý 9 chiến thuật</button>
      </div>
    </section>

    <!-- Results -->
    <div id="results" class="space-y-6"></div>

    <footer class="text-center text-xs text-slate-500 pt-6 pb-12">StoryFlow 9 • Kallaway-inspired • HTML + Tailwind + Vanilla JS</footer>
  </main>

  <script>
    // --- Helpers & Presets ---
    const $ = (id) => document.getElementById(id);

    const topicExamples = [
      "AI giúp học sinh tiểu học học Toán nhanh hơn",
      "9 chiến thuật kể chuyện giúp video YouTube tăng giữ chân",
      "HDPE: Lót hồ tưới tiết kiệm chi phí và chống rò rỉ",
      "Luật Đất đai 2024: 5 bước xin cấp sổ lần đầu dễ hiểu",
      "VNIndex & sóng Elliott: Hai kịch bản 30 ngày tới",
      "Trump Brand: Tên tuổi đáng giá hơn vàng?",
      "Phật pháp ứng dụng: 3 thói quen giảm căng thẳng mỗi ngày",
      "Real Estate Quy Nhơn: Chọn căn hộ theo 7 tiêu chí cốt lõi"
    ];

    const audienceExamples = [
      "Phụ huynh có con cấp 1",
      "Người mới học AI",
      "Nhà đầu tư chứng khoán cá nhân",
      "Khách hàng bất động sản Quy Nhơn",
      "Chủ trang trại/nhà máy cần HDPE",
      "Doanh nhân trẻ 20–35 tuổi",
      "Phụ huynh quan tâm an toàn số cho con",
      "Người thực hành chánh niệm"
    ];

    const platformSpecs = {
      yt:  { label: "YouTube (8–12 phút)", switchSec: 4 },
      shorts: { label: "Shorts/Reels (45–60s)", switchSec: 3 },
      tiktok: { label: "TikTok (60–120s)", switchSec: 3 },
      pod: { label: "Podcast video (15–30p)", switchSec: 6 },
    };

    function sentence(s) {
      const t = (s || "").trim();
      if (!t) return "";
      const last = t.slice(-1);
      return ".!?".includes(last) ? t : t + ".";
    }

    function makeChip(text) {
      const span = document.createElement("span");
      span.className = "inline-flex items-center rounded-full border border-slate-300 px-2.5 py-1 text-xs font-medium text-slate-700 bg-white";
      span.textContent = text;
      return span;
    }

    function sectionCard({badge, title, html}) {
      const wrap = document.createElement("section");
      wrap.className = "bg-white/80 backdrop-blur rounded-2xl shadow-sm border border-slate-200 p-5 md:p-6 fade-in";
      wrap.innerHTML = `
        <div class="flex items-start gap-3 mb-3">
          <div class="h-9 w-9 shrink-0 rounded-xl bg-slate-900 text-white flex items-center justify-center text-sm font-semibold">${badge}</div>
          <h3 class="text-xl md:text-2xl font-semibold text-slate-800 leading-tight">${title}</h3>
        </div>
        <div class="prose prose-slate max-w-none text-sm md:text-base">${html}</div>
      `;
      return wrap;
    }

    function buildEngine(input) {
      const { topic, audience, goal, platform, tone } = input;
      const p = platformSpecs[platform] || platformSpecs.shorts;
      const switchEvery = p.switchSec;

      const compMax = {
        speak: [
          `Trong video hôm nay, chúng ta sẽ nói về: ${topic}`,
          `Mục tiêu: ${goal || "giúp khán giả áp dụng được ngay"}`
        ].map(sentence),
        visuals: [
          `Khung mở: text động trên màn hình hiển thị chủ đề "${topic}"`,
          "Cut-in: ví dụ thực tế 3–5 giây minh họa vấn đề",
          "Overlay từ khóa chính bám theo lời nói (2–4 từ/slide)"
        ]
      };

      const hawkeye = {
        openContext: sentence(`Vấn đề lớn của ${audience}: vì sao ${topic.toLowerCase()} lại quan trọng?`),
        deepen: [
          "Phần 1 – Bối cảnh rộng: dữ liệu/quan sát phổ quát",
          "Phần 2 – Nguyên lý/lý thuyết cốt lõi",
          "Phần 3 – Ví dụ cụ thể và cách làm từng bước"
        ].map(sentence)
      };

      const metaphors = [
        `${topic} giống như một “gia sư vô hình” luôn trực 24/7`,
        "Dòng chảy câu chuyện như thủy triều: lên – căng – xả – lắng",
        "Bản đồ trước – đường đi sau: có map rồi mới lái xe"
      ];

      const commonGround = {
        opener: sentence("Tôi từng ở vị trí của bạn: hoang mang, sợ con nghiện màn hình, và không biết bắt đầu từ đâu."),
        we: sentence("Nhưng khi chúng ta thử một cách tiếp cận mới, mọi thứ bắt đầu thay đổi."),
        ref: sentence("Những ví dụ đời thực ngay sau đây sẽ giúp chúng ta thấy rõ.")
      };

      const simplify = [
        "Chia nhỏ khái niệm thành 3 ý cốt lõi, mỗi ý ≤ 1 câu ngắn",
        "Tránh thuật ngữ – nếu buộc dùng, luôn kèm ví dụ",
        "Dùng câu chủ động, động từ mạnh, số liệu tròn dễ nhớ"
      ];

      const visualStun = {
        cadence: sentence(`Đổi khung hình mỗi ${switchEvery} giây (cận/medium/toàn, text, b-roll, màn hình demo).`),
        edits: [
          "Nhảy cắt theo ý (jump cut) để nhấn nhịp tư duy",
          "Slow Zoom 5–8% trên đoạn giải thích quan trọng",
          "Insert b-roll minh họa ví dụ trước – sau"
        ]
      };

      const valueCompression = {
        first10s: [
          "Nói lợi ích lớn nhất ngay 5–10 giây đầu",
          "Hiển thị kết quả/cuối đường trước, hành trình sau"
        ].map(sentence),
        sample: sentence(`“Chỉ một thay đổi nhỏ hôm nay, ${audience.toLowerCase()} sẽ thấy kết quả ngay tuần này.”`)
      };

      const proofAssets = (input.proofAssets || "")
        .split(/,\s*/g)
        .filter(Boolean)
        .length ? input.proofAssets.split(/,\s*/g).filter(Boolean)
                : ["Ảnh trước/sau", "Feedback khách hàng", "Clip thực hành", "Số liệu tiến bộ"];

      const proof = {
        copy: sentence("Đưa bằng chứng thật để tắt ‘máy dò BS’: ảnh, video, số liệu, hóa đơn, case study."),
        assets: proofAssets
      };

      const contrast = {
        template: sentence("Kỳ vọng → Bẻ ngoặt → Giải thích tại sao → Lợi ích bất ngờ"),
        hooks: [
          "Tôi đã sai suốt 3 năm…",
          "Cách phổ biến nhất thực ra lại kém hiệu quả nhất",
          "Điều không ai nói cho bạn biết…"
        ]
      };

      const outline = [
        { part: "Hook (0–10s)", content: [valueCompression.sample, contrast.hooks[1], compMax.speak[0]] },
        { part: "Bối cảnh (10–30s)", content: [hawkeye.openContext, commonGround.opener] },
        { part: "Nguyên lý (30–60s)", content: [metaphors[0], simplify[0]] },
        { part: "Cách làm (1–3p)", content: ["Bước 1: …", "Bước 2: …", "Bước 3: …"] },
        { part: "Bằng chứng (đan xen)", content: proof.assets },
        { part: "Kết thúc/CTA", content: ["Bạn sẽ thử điều gì ngay hôm nay?", "Comment từ khóa để nhận template miễn phí."] }
      ];

      const thumb = [
        "Tiêu đề 3–5 từ mạnh: ‘AI LÀ GIA SƯ?’",
        "Ảnh chính: gương mặt cảm xúc + vật thể ẩn dụ (đèn bàn, sách mở)",
        "Chữ bổ trợ 2–3 từ: ‘Nhanh Gấp 3’"
      ];

      const broll = [
        "Bé học cùng laptop/ChatGPT",
        "Close-up tay gõ bàn phím",
        "Biểu đồ trước/sau",
        "Giấy khen/điểm số"
      ];

      return { compMax, hawkeye, metaphors, commonGround, simplify, visualStun, valueCompression, proof, contrast, outline, thumb, broll, switchEvery, p, tone, topic, audience, goal };
    }

    function ul(items) {
      return `<ul>${items.map(t => `<li>${t}</li>`).join("")}</ul>`;
    }

    function renderAll(engine) {
      const out = $("results");
      out.innerHTML = "";

      // Chips row
      const chips = $("chips");
      chips.innerHTML = "";
      chips.appendChild(makeChip("Chủ đề: " + engine.topic));
      chips.appendChild(makeChip("Đối tượng: " + engine.audience));
      chips.appendChild(makeChip("Mục tiêu: " + engine.goal));
      chips.appendChild(makeChip("Nền tảng: " + engine.p.label));
      chips.appendChild(makeChip("Tông giọng: " + engine.tone));
      chips.appendChild(makeChip("Đổi khung hình mỗi " + engine.switchEvery + "s"));

      // Sections
      const sectionCardEl = (badge, title, html) => sectionCard({ badge, title, html });

      out.appendChild(sectionCardEl("1", "Comprehension Maxing – Ghép lời nói với hình ảnh",
        `<p class="font-medium">Lời thoại gợi ý:</p>${ul(engine.compMax.speak.map(s=>"🗣️ "+s))}
         <div class="h-px bg-slate-200 my-4"></div>
         <p class="font-medium">Hình ảnh gợi ý:</p>${ul(engine.compMax.visuals.map(v=>"🎞️ "+v))}`));

      out.appendChild(sectionCardEl("2", "Hawkeye Narrative – Từ tổng thể đến chi tiết",
        `<p>${engine.hawkeye.openContext}</p><div class="mt-3">${ul(engine.hawkeye.deepen)}</div>`));

      out.appendChild(sectionCardEl("3", "Visual Examples & Metaphors – Ẩn dụ trực quan",
        ul(engine.metaphors.map(m=>"💡 "+m))));

      out.appendChild(sectionCardEl("4", "Common Ground – Điểm chung với khán giả",
        `<p>${engine.commonGround.opener}</p><p>${engine.commonGround.we}</p><p>${engine.commonGround.ref}</p>`));

      out.appendChild(sectionCardEl("5", "Simpler Words & Ideas – Ngắn gọn và dễ hiểu",
        ul(engine.simplify.map(s=>"✏️ "+s))));

      out.appendChild(sectionCardEl("6", "Visual Stun Gun – Nhịp hình giữ chú ý",
        `<p>${engine.visualStun.cadence}</p><div class="mt-2">${ul(engine.visualStun.edits.map(e=>"🎬 "+e))}</div>`));

      out.appendChild(sectionCardEl("7", "Value Compression – Nén giá trị lên đầu",
        `<p class="font-medium">Trong 10 giây đầu:</p>${ul(engine.valueCompression.first10s.map(v=>"⚡ "+v))}
         <p class="mt-2">Câu mẫu: <span class="font-semibold">${engine.valueCompression.sample}</span></p>`));

      out.appendChild(sectionCardEl("8", "Come With Proof – Đưa bằng chứng thật",
        `<p>${engine.proof.copy}</p><div class="mt-2">${ul(engine.proof.assets.map(a=>"📎 "+a))}</div>`));

      out.appendChild(sectionCardEl("9", "Set Up Contrast – Tạo tương phản & bất ngờ",
        `<p>Mẫu cấu trúc: ${engine.contrast.template}</p>
         <div class="flex flex-wrap gap-2 mt-3">
           ${engine.contrast.hooks.map(h=>`<span class="px-2 py-1 rounded-full bg-slate-100 text-slate-700 text-xs border border-slate-200">${h}</span>`).join("")}
         </div>`));

      // Outline
      const rows = engine.outline.map(row => `
        <tr class="odd:bg-white even:bg-slate-50">
          <td class="align-top p-3 border-b w-48 font-medium">${row.part}</td>
          <td class="align-top p-3 border-b">${ul(row.content)}</td>
        </tr>
      `).join("");

      out.appendChild(sectionCardEl("📜", "Tóm tắt kịch bản đề xuất",
        `<div class="overflow-x-auto">
           <table class="w-full text-sm border border-slate-200 rounded-xl overflow-hidden">
             <thead class="bg-slate-50">
               <tr><th class="text-left p-3 border-b">Phần</th><th class="text-left p-3 border-b">Nội dung</th></tr>
             </thead>
             <tbody>${rows}</tbody>
           </table>
         </div>`));

      // Thumb & B-roll
      out.appendChild(sectionCardEl("🖼️","Gợi ý Thumbnail", ul([
        "Tiêu đề 3–5 từ mạnh: ‘AI LÀ GIA SƯ?’",
        "Ảnh chính: gương mặt cảm xúc + vật thể ẩn dụ (đèn bàn, sách mở)",
        "Chữ bổ trợ 2–3 từ: ‘Nhanh Gấp 3’"
      ])));
      out.appendChild(sectionCardEl("🎞️","Danh sách B-roll đề xuất", ul([
        "Bé học cùng laptop/ChatGPT",
        "Close-up tay gõ bàn phím",
        "Biểu đồ trước/sau",
        "Giấy khen/điểm số"
      ])));

      // Openers by tone
      out.appendChild(sectionCardEl("🎙️","Gợi ý lời thoại mở đầu (theo tông giọng)",
        ul([
          `<b>Hook tương phản:</b> "Tôi từng nghĩ ${engine.topic.toLowerCase()} là ý tưởng tệ — cho đến khi thấy kết quả."`,
          `<b>Giá trị tức thì:</b> "Trong 60 giây, bạn sẽ có 3 bước để ${engine.goal}."`,
          `<b>Bằng chứng lồng ghép:</b> "Đây là minh chứng thật từ ${engine.audience.toLowerCase()} tuần trước."`
        ])
      ));
    }

    // --- Initial values & events ---
    const defaults = {
      topic: topicExamples[0],
      audience: audienceExamples[0],
      goal: "giúp khán giả áp dụng được ngay",
      platform: "shorts",
      tone: "Truyền cảm hứng",
      proofAssets: "Ảnh trước/sau, Feedback khách hàng, Biểu đồ kết quả"
    };

    function setDefaults() {
      $("topic").value = defaults.topic;
      $("audience").value = defaults.audience;
      $("goal").value = defaults.goal;
      $("platform").value = defaults.platform;
      $("tone").value = defaults.tone;
      $("proofAssets").value = defaults.proofAssets;
      // Fill preset dropdown defaults
      $("topicPreset").value = "";
      $("audiencePreset").value = "";
    }

    function readInput() {
      return {
        topic: $("topic").value.trim() || defaults.topic,
        audience: $("audience").value,
        goal: $("goal").value.trim() || defaults.goal,
        platform: $("platform").value,
        tone: $("tone").value,
        proofAssets: $("proofAssets").value.trim()
      };
    }

    function makeChip(text) {
      const span = document.createElement("span");
      span.className = "inline-flex items-center rounded-full border border-slate-300 px-2.5 py-1 text-xs font-medium text-slate-700 bg-white";
      span.textContent = text;
      return span;
    }

    async function copyJson() {
      const input = readInput();
      const data = buildEngine(input);
      const payload = { input, data, topicExamples, audienceExamples };
      await navigator.clipboard.writeText(JSON.stringify(payload, null, 2));
      alert("Đã sao chép cấu hình + gợi ý ra clipboard!");
    }

    $("generateBtn").addEventListener("click", () => {
      const engine = buildEngine(readInput());
      renderAll(engine);
      window.scrollTo({ top: document.body.scrollHeight, behavior: "smooth" });
    });

    $("resetBtn").addEventListener("click", () => {
      setDefaults();
      $("results").innerHTML = "";
      $("chips").innerHTML = "";
    });

    $("copyJsonBtn").addEventListener("click", copyJson);

    // Preset apply handlers
    $("applyTopicPreset").addEventListener("click", () => {
      const val = $("topicPreset").value;
      if (val) $("topic").value = val;
    });
    $("applyAudiencePreset").addEventListener("click", () => {
      const val = $("audiencePreset").value;
      if (val) $("audience").value = val;
    });

    // Boot
    setDefaults();
  </script>
</body>
</html>
